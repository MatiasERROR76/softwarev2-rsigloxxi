{"ast":null,"code":"import _classCallCheck from\"C:/Users/admin/Desktop/Master/AprendiendoReact/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/admin/Desktop/Master/AprendiendoReact/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"C:/Users/admin/Desktop/Master/AprendiendoReact/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/admin/Desktop/Master/AprendiendoReact/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from'react';import{Redirect}from'react-router-dom';import axios from'axios';import SimpleReactValidator from'simple-react-validator';import Global from'../Global';import swal from'sweetalert';import Sidebar from'./Sidebar';import ImageDefault from'../assets/images/abc.jpg';// 1. Tenemos que recoger el id del articulo a editar en la url\n// 2. Crear un metodo para sacar ese objeto del backend\n// 3. Repoblar / rellenar el formulario con estos datos\n// 4. Actualizar el objeto haciendo una peticion al backend  \nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditArticle=/*#__PURE__*/function(_Component){_inherits(EditArticle,_Component);var _super=_createSuper(EditArticle);function EditArticle(){var _this;_classCallCheck(this,EditArticle);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.url=Global.url;_this.articleId=null;_this.titleRef=/*#__PURE__*/React.createRef();_this.contentRef=/*#__PURE__*/React.createRef();_this.state={article:{},status:null,selectedFile:null};_this.getArticle=function(id){axios.get(_this.url+'article/'+id).then(function(res){_this.setState({article:res.data.article});});};_this.changeState=function(){_this.setState({article:{title:_this.titleRef.current.value,content:_this.contentRef.current.value,image:_this.state.article.image}});_this.validator.showMessages();_this.forceUpdate();};_this.saveArticle=function(e){e.preventDefault();// Rellenar state formulario\n_this.changeState();if(_this.validator.allValid()){// Hacer una peticion http  por post para guardar articulo\naxios.put(_this.url+'article/'+_this.articleId,_this.state.article).then(function(res){if(res.data.article){_this.setState({article:res.data.article,status:'waiting'});swal('Articulo Actualizado.','El articulo fue modificado exitosamente.','success');// Subir la imagen\nif(_this.state.selectedFile!==null){// Sacar el id del articulo guardado\nvar articleId=_this.state.article._id;// Crear form data y añadir fichero\nvar formData=new FormData();formData.append('file0',_this.state.selectedFile,_this.state.selectedFile.name);// Peticion ajax\naxios.post(_this.url+'upload-image/'+articleId,formData).then(function(res){if(res.data.article){_this.setState({article:res.data.article,status:'success'});}else{_this.setState({article:res.data.article,status:'failed'});}});}else{_this.setState({status:'success'});}}else{_this.setState({status:'failed'});}});}else{_this.setState({status:'failed'});_this.validator.showMessages();_this.forceUpdate();}};_this.fileChange=function(event){_this.setState({selectedFile:event.target.files[0]});console.log(_this.state);};return _this;}_createClass(EditArticle,[{key:\"componentWillMount\",value:function componentWillMount(){this.articleId=this.props.match.params.id;this.getArticle(this.articleId);this.validator=new SimpleReactValidator({messages:{required:'Este campo es requerido.'}});}},{key:\"render\",value:function render(){console.log(this.state.article);if(this.state.status==='success'){return/*#__PURE__*/_jsx(Redirect,{to:\"/blog\"});}var article=this.state.article;return/*#__PURE__*/_jsxs(\"div\",{className:\"center\",children:[/*#__PURE__*/_jsxs(\"section\",{id:\"content\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"subheader\",children:\"Editar Articulo\"}),this.state.article.title&&/*#__PURE__*/_jsxs(\"form\",{className:\"mid-form\",onSubmit:this.saveArticle,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"Titulo\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",defaultValue:article.title,ref:this.titleRef,onChange:this.changeState}),this.validator.message('title',this.state.article.title,'required|alpha_num_space')]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"content\",children:\"Contenido\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"content\",defaultValue:article.content,ref:this.contentRef,onChange:this.changeState}),this.validator.message('content',this.state.article.content,'required')]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file0\",children:\"Imagen\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file0\",onChange:this.fileChange}),/*#__PURE__*/_jsx(\"div\",{className:\"image-wrap\",children:article.image!==null?/*#__PURE__*/_jsx(\"img\",{src:this.url+'get-image/'+article.image,alt:article.title,className:\"thumb\"}):/*#__PURE__*/_jsx(\"img\",{src:ImageDefault,alt:article.title,className:\"thumb\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"clearfix\"}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"Guardar\",className:\"btn btn-success\"})]}),!this.state.article.title&&/*#__PURE__*/_jsx(\"h1\",{className:\"subheader\",children:\" Cargando... \"})]}),/*#__PURE__*/_jsx(Sidebar,{})]});}}]);return EditArticle;}(Component);export default EditArticle;","map":{"version":3,"names":["React","Component","Redirect","axios","SimpleReactValidator","Global","swal","Sidebar","ImageDefault","EditArticle","url","articleId","titleRef","createRef","contentRef","state","article","status","selectedFile","getArticle","id","get","then","res","setState","data","changeState","title","current","value","content","image","validator","showMessages","forceUpdate","saveArticle","e","preventDefault","allValid","put","_id","formData","FormData","append","name","post","fileChange","event","target","files","console","log","props","match","params","messages","required","message"],"sources":["C:/Users/admin/Desktop/Master/AprendiendoReact/src/components/EditArticle.js"],"sourcesContent":["import React, { Component } from 'react';\r\nimport { Redirect } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport SimpleReactValidator from 'simple-react-validator';\r\nimport Global from '../Global';\r\nimport swal from 'sweetalert';\r\nimport Sidebar from './Sidebar';\r\nimport ImageDefault from '../assets/images/abc.jpg';\r\n\r\n\r\n\r\n// 1. Tenemos que recoger el id del articulo a editar en la url\r\n// 2. Crear un metodo para sacar ese objeto del backend\r\n// 3. Repoblar / rellenar el formulario con estos datos\r\n// 4. Actualizar el objeto haciendo una peticion al backend  \r\n\r\nclass EditArticle extends Component {\r\n\r\n    url = Global.url;\r\n\r\n    articleId = null;\r\n\r\n    titleRef = React.createRef();\r\n    contentRef = React.createRef();\r\n\r\n\r\n    state = {\r\n        article: {},\r\n        status: null,\r\n        selectedFile: null\r\n    };\r\n\r\n    componentWillMount() {\r\n        this.articleId = this.props.match.params.id;\r\n        this.getArticle(this.articleId);\r\n\r\n        this.validator = new SimpleReactValidator({\r\n            messages: {\r\n                required: 'Este campo es requerido.'\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    getArticle = (id) => {\r\n        axios.get(this.url + 'article/' + id)\r\n            .then(res => {\r\n                this.setState({\r\n                    article: res.data.article\r\n                })\r\n            });\r\n\r\n    }\r\n\r\n\r\n    changeState = () => {\r\n        this.setState({\r\n            article: {\r\n                title: this.titleRef.current.value,\r\n                content: this.contentRef.current.value,\r\n                image: this.state.article.image\r\n            }\r\n        });\r\n\r\n        this.validator.showMessages();\r\n        this.forceUpdate();\r\n\r\n\r\n\r\n    }\r\n\r\n    saveArticle = (e) => {\r\n        e.preventDefault();\r\n\r\n        // Rellenar state formulario\r\n        this.changeState();\r\n\r\n\r\n        if (this.validator.allValid()) {\r\n\r\n\r\n            // Hacer una peticion http  por post para guardar articulo\r\n\r\n            axios.put(this.url + 'article/'+this.articleId, this.state.article)\r\n                .then(res => {\r\n                    if (res.data.article) {\r\n\r\n                        this.setState({\r\n                            article: res.data.article,\r\n                            status: 'waiting'\r\n                        });\r\n\r\n                        swal(\r\n                            'Articulo Actualizado.',\r\n                            'El articulo fue modificado exitosamente.',\r\n                            'success'\r\n                        )\r\n\r\n\r\n\r\n\r\n                        // Subir la imagen\r\n\r\n                        if (this.state.selectedFile !== null) {\r\n\r\n                            // Sacar el id del articulo guardado\r\n                            var articleId = this.state.article._id;\r\n\r\n                            // Crear form data y añadir fichero\r\n                            const formData = new FormData();\r\n\r\n                            formData.append(\r\n                                'file0',\r\n                                this.state.selectedFile,\r\n                                this.state.selectedFile.name\r\n                            );\r\n\r\n\r\n                            // Peticion ajax\r\n\r\n                            axios.post(this.url + 'upload-image/' + articleId, formData)\r\n                                .then(res => {\r\n                                    if (res.data.article) {\r\n\r\n                                        this.setState({\r\n                                            article: res.data.article,\r\n                                            status: 'success'\r\n                                        });\r\n\r\n                                    } else {\r\n\r\n                                        this.setState({\r\n                                            article: res.data.article,\r\n                                            status: 'failed'\r\n                                        });\r\n                                    }\r\n                                });\r\n\r\n\r\n                        } else {\r\n                            this.setState({\r\n                                status: 'success'\r\n                            });\r\n\r\n\r\n\r\n                        }\r\n\r\n                    } else {\r\n\r\n                        this.setState({\r\n                            status: 'failed'\r\n                        });\r\n\r\n                    }\r\n                });\r\n        } else {\r\n\r\n            this.setState({\r\n                status: 'failed'\r\n            });\r\n\r\n            this.validator.showMessages();\r\n            this.forceUpdate();\r\n        }\r\n    }\r\n\r\n\r\n    fileChange = (event) => {\r\n        this.setState({\r\n            selectedFile: event.target.files[0]\r\n        });\r\n\r\n        console.log(this.state);\r\n    }\r\n\r\n\r\n    render() {\r\n        console.log(this.state.article);\r\n        if (this.state.status === 'success') {\r\n            return <Redirect to=\"/blog\" />;\r\n        }\r\n\r\n\r\n\r\n        var article = this.state.article;\r\n        return (\r\n            <div className=\"center\">\r\n                <section id=\"content\">\r\n                    <h1 className=\"subheader\">Editar Articulo</h1>\r\n\r\n                    {this.state.article.title &&\r\n                            <form className=\"mid-form\" onSubmit={this.saveArticle}>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"title\">Titulo</label>\r\n                                <input type=\"text\" name=\"title\" defaultValue={article.title} ref={this.titleRef} onChange={this.changeState} />\r\n    \r\n                                {this.validator.message('title', this.state.article.title, 'required|alpha_num_space')}\r\n    \r\n    \r\n                            </div>\r\n    \r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"content\">Contenido</label>\r\n                                <textarea name=\"content\" defaultValue={article.content}  ref={this.contentRef} onChange={this.changeState} ></textarea>\r\n    \r\n                                {this.validator.message('content', this.state.article.content, 'required')}\r\n    \r\n                            </div>\r\n    \r\n    \r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"file0\">Imagen</label>\r\n                                    \r\n                                <input type=\"file\" name=\"file0\" onChange={this.fileChange} />\r\n                                <div className=\"image-wrap\">\r\n                                    {\r\n                                        article.image !== null ? (\r\n                                            <img src={this.url + 'get-image/' + article.image} alt={article.title} className=\"thumb\"/>\r\n                                        ) : (\r\n                                            <img src={ImageDefault} alt={article.title} className=\"thumb\" />\r\n                                        )\r\n                                    }\r\n                                    </div>\r\n                            \r\n                            </div>\r\n    \r\n                            <div className=\"clearfix\"></div>         \r\n                            <input type=\"submit\" value=\"Guardar\" className=\"btn btn-success\" />\r\n    \r\n                        </form>\r\n    \r\n                    }\r\n\r\n                \r\n                    {!this.state.article.title &&\r\n                        <h1 className=\"subheader\"> Cargando... </h1>\r\n                    }\r\n\r\n\r\n                </section>\r\n\r\n                <Sidebar />\r\n            </div >\r\n\r\n        );\r\n    }\r\n}\r\n\r\n\r\nexport default EditArticle;"],"mappings":"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"},"metadata":{},"sourceType":"module"}